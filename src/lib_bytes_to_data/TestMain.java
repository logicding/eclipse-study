package com.example.lib;


import java.lang.reflect.Array;
import java.util.Arrays;

public class TestMain {

    private static int nOneFaceLength = 2208;
    private static int nOneHandLenght = 880;
    private static byte[] hexString2Bytes(String src) {
        int l = src.length() / 2;
        byte[] ret = new byte[l];
        for (int i = 0; i < l; i++) {
            ret[i] = (byte) Integer
                    .valueOf(src.substring(i * 2, i * 2 + 2), 16).byteValue();
        }
        return ret;
    }
    public static void showKonkaAIRaw(String strAIData)
    {
        System.out.println("showKonkaAIRaw");
        byte [] strTestbytes = hexString2Bytes(strAIData);
        System.err.println("length:" + strTestbytes.length);

        byte [] bytesFlag = ByteUtil.subBytes(strTestbytes, 0, 32);
        byte [] bytesFaceCount = ByteUtil.subBytes(strTestbytes, 32, 4);
        byte [] bytesHandCount = ByteUtil.subBytes(strTestbytes, 36, 4);
        byte [] bytesBrightness = ByteUtil.subBytes(strTestbytes, 40, 4);

        int nFaceCount = ByteUtil.getInt(bytesFaceCount);
        System.out.println("Flag:" + new String(bytesFlag));
        System.out.println("FaceCount:" + nFaceCount);
        System.out.println("HandCount:" + ByteUtil.getInt(bytesHandCount));
        System.out.println("Brightness:" + ByteUtil.getInt(bytesBrightness));

        FaceObject [] arryFaces = new FaceObject[nFaceCount];

        byte [] bytesFaceData = ByteUtil.subBytes(strTestbytes, 44, nFaceCount*nOneFaceLength);
        int i = 0;
        int nPointsIndex = 0;
        int nFeatureIndex = 0;
        int nIndex = 0;
        for (i=0; i<nFaceCount; ++i)
        {
            arryFaces[i] = new FaceObject();
            arryFaces[i].setFaceTrackId(ByteUtil.getInt(ByteUtil.subBytes(bytesFaceData, i*nOneFaceLength+nIndex, 4)));
            nIndex += 4;
            arryFaces[i].setFaceRectLeft(ByteUtil.getInt(ByteUtil.subBytes(bytesFaceData, i*nOneFaceLength+nIndex, 4)));
            nIndex += 4;
            arryFaces[i].setFaceRectTop(ByteUtil.getInt(ByteUtil.subBytes(bytesFaceData, i*nOneFaceLength+nIndex, 4)));
            nIndex += 4;
            arryFaces[i].setFaceRectRight(ByteUtil.getInt(ByteUtil.subBytes(bytesFaceData, i*nOneFaceLength+nIndex, 4)));
            nIndex += 4;
            arryFaces[i].setFaceRectButtom(ByteUtil.getInt(ByteUtil.subBytes(bytesFaceData, i*nOneFaceLength+nIndex, 4)));
            nIndex += 4;
            arryFaces[i].setFacePointCount(ByteUtil.getInt(ByteUtil.subBytes(bytesFaceData, i*nOneFaceLength+nIndex, 4)));
            nIndex += 4;
            arryFaces[i].setFaceFeatureLen(ByteUtil.getInt(ByteUtil.subBytes(bytesFaceData, i*nOneFaceLength+nIndex, 4)));
            nIndex += 4;
            arryFaces[i].setFaceAttributeCount(ByteUtil.getInt(ByteUtil.subBytes(bytesFaceData, i*nOneFaceLength+nIndex, 4)));
            nIndex += 4;
            arryFaces[i].setFaceYaw(ByteUtil.getInt(ByteUtil.subBytes(bytesFaceData, i*nOneFaceLength+nIndex, 4)));
            nIndex += 4;
            arryFaces[i].setFacePitch(ByteUtil.getFloat(ByteUtil.subBytes(bytesFaceData, i*nOneFaceLength+nIndex, 4)));
            nIndex += 4;
            arryFaces[i].setFaceRoll(ByteUtil.getFloat(ByteUtil.subBytes(bytesFaceData, i*nOneFaceLength+nIndex, 4)));
            nIndex += 4;
            arryFaces[i].setFaceQuality(ByteUtil.getFloat(ByteUtil.subBytes(bytesFaceData, i*nOneFaceLength+nIndex, 4)));
            nIndex += 4;

            int nFacePointCount = arryFaces[i].getFacePointCount();
            int nFaceFeatureLen = arryFaces[i].getFaceFeatureLen();
            int nFaceAttributeCount = arryFaces[i].getFaceAttributeCount();

            byte [] bytesFacePointData = ByteUtil.subBytes(bytesFaceData, nIndex, 8*nFacePointCount);
            arryFaces[i].arrFacePoint = new MyPoint[nFacePointCount];
            nIndex += 8*106;
            for (nPointsIndex=0; nPointsIndex<nFacePointCount; ++nPointsIndex)
            {
                MyPoint stPoint = new MyPoint();
                stPoint.x = (int)ByteUtil.getFloat(ByteUtil.subBytes(bytesFacePointData, 4*2*nPointsIndex, 4));
                stPoint.y = (int)ByteUtil.getFloat(ByteUtil.subBytes(bytesFacePointData, 4*(2*nPointsIndex+1), 4));
                arryFaces[i].arrFacePoint[nPointsIndex] = stPoint;
            }

            arryFaces[i].arrFaceFeature = ByteUtil.subBytes(bytesFaceData, nIndex, nFaceFeatureLen);
            nIndex += 512;

            byte [] bytesFaceAttributeData = ByteUtil.subBytes(bytesFaceData, nIndex, 40*nFaceAttributeCount);
            arryFaces[i].arrFaceAttribute = new FaceAttribute[nFaceAttributeCount];
            nIndex += 40*20;

            for (nFeatureIndex=0; nFeatureIndex<nFaceAttributeCount; ++nFeatureIndex)
            {
                FaceAttribute stFaceAttribute = new FaceAttribute();
                stFaceAttribute.setStrName(new String(ByteUtil.subBytes(bytesFaceAttributeData, 40*nFeatureIndex, 16)));
                stFaceAttribute.setStrLabel(new String(ByteUtil.subBytes(bytesFaceAttributeData, 40*nFeatureIndex+16, 16)));
                stFaceAttribute.setfLabel(ByteUtil.getFloat(ByteUtil.subBytes(bytesFaceAttributeData, 40*nFeatureIndex+32, 4)));
                stFaceAttribute.setScore(ByteUtil.getFloat(ByteUtil.subBytes(bytesFaceAttributeData, 40*nFeatureIndex+36, 4)));
                arryFaces[i].arrFaceAttribute[nFeatureIndex] = stFaceAttribute;
            }
            System.out.println(arryFaces[i].toString());
        }
    }
    public static void showChangHongAIRaw(String strAIData)
    {
        System.out.println("showChangHongAIRaw");
         byte [] strTestbytes = hexString2Bytes(strAIData);
        System.err.println("length:" + strTestbytes.length);

        byte [] bytesFlag = ByteUtil.subBytes(strTestbytes, 0, 32);
        byte [] bytesMsgID = ByteUtil.subBytes(strTestbytes, 32, 4);
        byte [] bytesByteStreamLen = ByteUtil.subBytes(strTestbytes, 36, 4);


        int nFeatureIndex = 0;
        int nFeatureStart = 40;
        int nByteStreamLen = ByteUtil.getInt(bytesByteStreamLen);
        int nMsgID = ByteUtil.getInt(bytesMsgID);
        System.out.println("Flag:" + new String(bytesFlag));
        System.out.println("MsgID:" + nMsgID);
        System.out.println("ByteStreamLen:" + nByteStreamLen);
        int nFeatureCount = 0;  // 算法数据个数
        CHFeatureObject[] arryFeatureObject = null;
        if (40 != nByteStreamLen)
        {
            byte [] bytesFeatureCount = ByteUtil.subBytes(strTestbytes, nFeatureStart, 4);
            nFeatureCount = ByteUtil.getInt(bytesFeatureCount);
            if (nFeatureCount>0)
            {
                int nFeatureReadIndex = 4;
                arryFeatureObject = new CHFeatureObject[nFeatureCount];
                for (nFeatureIndex = 0; nFeatureIndex < nFeatureCount; ++nFeatureIndex)
                {
                    CHFeatureObject stFeatureObject = new CHFeatureObject();
                    stFeatureObject.nType = ByteUtil.getInt(ByteUtil.subBytes(strTestbytes, nFeatureStart+nFeatureReadIndex, 4));
                    nFeatureReadIndex += 4;
                    stFeatureObject.nId = ByteUtil.getInt(ByteUtil.subBytes(strTestbytes, nFeatureStart+nFeatureReadIndex, 4));
                    nFeatureReadIndex += 4;
                    stFeatureObject.nBufLen = ByteUtil.getInt(ByteUtil.subBytes(strTestbytes, nFeatureStart+nFeatureReadIndex, 4));
                    nFeatureReadIndex += 4;
                    stFeatureObject.arryBuffer = ByteUtil.subBytes(strTestbytes, nFeatureStart+nFeatureReadIndex, stFeatureObject.nBufLen);
                    nFeatureReadIndex += stFeatureObject.nBufLen;
                    stFeatureObject.ChangFeatureData();
                    arryFeatureObject[nFeatureIndex] = stFeatureObject;
                }
            }
        }

        System.out.println("FeatureCount:" + nFeatureCount);
        System.out.println("Features:" + Arrays.toString(arryFeatureObject));
        byte [] bytesFaceJson = ByteUtil.subBytes(strTestbytes, nByteStreamLen, strTestbytes.length-nByteStreamLen);
        System.out.println("jsonData:" + ByteUtil.getString(bytesFaceJson));
    }
    public static void main(String[] args) {
        String strKonkaTestBuff = "4B4B5F43414D4552415F4155544F5F524553554C5400000000000000000000000100000000000000FFFFFFFF01000000DC010000C9000000C2020000AF0100006A000000000000000B000000B72589C1451E86C13F4ED3C00E476E3ED849EE43842B89434ED0EF4386359143C033F0434A959843E230F143709A9F433FFBF1437217A643E691F243F089AD43AA01F643B2F9B3436C13FA436AFBB943DC93FE43C444C043577D024402B0C4438B090644CCE6C843129D09441ED5CA4366FC0C445863CC4328AB1044961ECF434ADF134416FBD043A0F817443CC2D243DC471B4412FCD24395361E44A44BD24332F620440425D24344BF22447661D043CDDC2544F8F5CD43A8502744189ECA434D38294404B9C6430CF62A442CF6C3430C322C44D24DBF4389A32D44CA36BA437BDC2E446495B443974C2F44F01FAF43197C304412EDA94362F32F449A59A443CC7030446E439F436B8430443CDA9943AAA93044CEBE9243DDCE064487C05E43949A0B443D5053435ACE0F440BCD5243AB511444C3D25743602F184414565D432ACE2244972C6843FC2126440FB468438A092944A05669432E8E2B446B896F4312A32E449BBE7D43CA3F1E4492107D4344B71E44A21E844304981F44EAD98743F18A20447E138C4335F01644D1A1974390F91A447AAA974380541E4444899843A9612144D96C9A431A0F2444B8A29B43B4DE0A44E86D7243E9BA0D4401E16C43C94913442D9D72432552154447277B43D7FB124419DF7A43B5730D443BA37643D0132344CAB7834313782544CE84814389772A44AEA28443ACF92B4494068843D4E22944969F88434A9B254464388643E88F0B44E6415C430F1C1044EBCB5C430B471444EDC86143EE361844188E66438E7B22449F8D7043BDCB2544F5357343C1DD2844416B7343AECF2B44D2257A432287104499F56D43D11510445B067943FB591044B36C7343713228443067814389942744C401884387832744E8468543830B1A44F7607B430FD22044687F804308CA174484508B43F0DA23441C3C8E4377131544F6059143737225443ABD9743456512442C8CAB4371121744925EA3439AAD1C44FCCE9F4396DD1E44A9E0A043ECE72044F63FA1435C33244420E3A84349FF24441ADDB24384192344806BB643A25820448822B743C97C1C44F224B6434AD118449696B34346B61544D048B043DCCC1344B6CBAB43087A18447E7DA74340961E449AF5A74360CC2144647BAB4300A8234406D9B24384CE20445A45B243868C1D444081B0431A75174412F7AE4350531044E6FC754336552844E4CF8543000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000067656E64657200000000000000000000000000000000000000000000000000000000803F0000803F6D61736B00000000000000000000000000000000000000000000000000000000000000000000803F676C6173730000000000000000000000000000000000000000000000000000000000803F0000803F7261636500000000000000000000000000000000000000000000000000000000000000000000803F656D6F74696F6E00000000000000000000000000000000000000000000000000000040400000803F616765000000000000000000000000000000000000000000000000000000000000ECE7410000803F62656172640000000000000000000000000000000000000000000000000000000000803F0000803F6579650000000000000000000000000000000000000000000000000000000000000000000000803F6D6F757468000000000000000000000000000000000000000000000000000000000000000000803F666163655F76616C7565000000000000000000000000000000000000000000000000903D0000803F736D696C650000000000000000000000000000000000000000000000000000000050713F0000803F0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000";
        String strChangHongTestBuff = "43485F43414D4552415F4155544F5F524553554C540000000000000000000000"+
                "0B000000"+
                "88030000"+
                "02000000" +
                "01000000" +
                "08000000" +
                "50030000"+"312D50447AF28443D3655144DFFC8C43DE9F5144E1A69343E78652444D429A43D40A5344E735A043A07C53443A4DA743120155445E3FAD434E5456448614B343D0CA574414B4B94354F95944AE2FBF43086A5C44F2C0C443B0FA5E448544C8436B6061448B8DCB43C00C6444F3B6D04344636644E1C9D3433BFF6944AE29D6434AEA6C441D73D64399787044150AD443F5627344379DD2437C407544F913CF43338178447E71CA43C4FE79441BE2C44336FD7B44005CBF431BBE7D4477AABA43ECD97E442396B4436D268044B646AE43C9B9804458BAA643C8F580444777A043AF8E814479729943EF5281448D449343F094814462388D43EEA4814456B0864371AC81448EC37C43554057448E02864338105B4480488043B6FA5E448AD47F43D5236344139D8143FB8B66443DF382438F7471443E658143125E7544B2757B4354CE7844E6127643FA447C44B4867543A836804408417D436F486C44C4498F4352496C4460D6984318EE6C44A7B2A04328536D449D02A943250C6744D66CAF43C0716A44CDF7AF4336EA6C445BCCB043DBDD6F44546CB0438E907244EDEBAE43CF205C443FFE9043689E5E4430C48E436B8E63447FEE8F43B2736544CA2B9243A27263443B369443FD585E4464EB9343E92A72447C6B8F4389947444CE598C4381EB7944BA498B43EFFC7B4490C28B434C027A442CC98F43FE467544D4009143068A5B44323C8543F0825F4451498543FA7A6344C20986437706674479EE8643589C71444ABC8443865C7544EEFB8243051A7944171A804395A17C448C288043BE3461446EF88E4390C3604464D9944345E4604491039143D852774427A98A43DC937744C288914328227744C0238E43B0F16844FB8690439E5B6F4470DE8E430A0C674468A5A4433AD07144721AA34302506544A50BAA439A8A73449188AA43086F654450F4BD43DAD46844B4ABBB4304A76B44882CBB433F336D44C493BB43CC9A6E44D651BA43234B7144136BBB43B2D07344C1AEBC43BCA3724408CEC1430B2270442DB5C3430C866C449E5BC54395D26944215DC4434C7E674480D8C14320FE65444B13BE439F606944FE73BE43F3686D445C53BF43BC6F70442E76BD43BC8273445A26BD43CD14704479FBBD43123B6D441242BF4325CE68444F9FBF43DEE36044B943924338E9774460918E437B0A09226576656E74223A092261696465746563745F726573756C74222C0A0922726573756C74223A09224F4B222C0A09226661636520696E666F73223A095B7B0A09090922666163654944223A09382C0A0909092266616365207175616C697479223A09302E38313932342C0A09090922666163652064697374616E6365223A09302C0A090909226661636520617474726962757465206E756D223A0931312C0A0909092266616365206B657920706F696E7473206E756D223A093130362C0A09090922666163652072656374616E676C65223A097B0A09090909226C656674223A093833322C0A0909090922746F70223A093233342C0A09090909227269676874223A09313033372C0A0909090922626F74746F6D223A093433390A0909097D2C0A09090922666163652072656374616E676C65223A097B0A0909090922796177223A092D332E393833352C0A09090909227069746368223A0931372E3130322C0A0909090922726F6C6C223A09312E383237370A0909097D2C0A090909226661636520617474726962757465223A097B0A090909092267656E646572223A09302C0A09090909226D61736B223A09302C0A0909090922676C617373223A09312C0A090909092272616365223A09302C0A0909090922656D6F74696F6E223A09362C0A0909090922616765223A0933312E3639322C0A09090909226265617264223A09302C0A0909090922657965223A09302C0A09090909226D6F757468223A09312C0A0909090922666163655F76616C7565223A09302E32333638322C0A0909090922736D696C65223A09302E33353232390A0909097D0A09097D5D0A7D0000000000";
        showChangHongAIRaw(strChangHongTestBuff);
        //showKonkaAIRaw(strKonkaTestBuff);
    }
}